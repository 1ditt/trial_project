trigger:
  branches:
    include:
      - main

stages:
- stage: Check_Modeling_Standards 
  
  jobs:
  - job: Check_Modeling_Standards
    displayName: 'Check_Modeling_Standards'
    pool: Default

    steps:
        - checkout: self 
          displayName: 'Checkout Repository'

        - script: |
              mkdir -p "$(System.DefaultWorkingDirectory)/temp"
              echo "Created a new 'temp' folder in $(System.DefaultWorkingDirectory)."
          displayName: 'Create Temp Folder in Default Working Directory'
          
        - script: |
            echo "Hello World" > $(System.DefaultWorkingDirectory)/temp/hello_world.txt
            echo "Created hello_world.txt in the temp directory."
          displayName: 'Create Hello World Text File'

        - task: ArtifactoryGenericUpload@2
          inputs:
            artifactoryService: 'BasicAuth-artifactory'
            specSource: 'taskConfiguration'
            fileSpec: |
              {
                "files": [
                  {
                    "pattern": "$(System.DefaultWorkingDirectory)/temp/**",
                    "target": "myrepo-generic-local/"
                  }
                ]
              }
            failNoOp: true

  
        - task: ArtifactoryGenericDownload@3
          inputs:
            connection: 'BasicAuth-artifactory'
            specSource: 'taskConfiguration'
            fileSpec: |
              {
                "files": [
                  {
                    "pattern": "myrepo-generic-local/**",
                    "target": "$(System.DefaultWorkingDirectory)/work/"
                  }
                ]
              }
            failNoOp: true
        - task: CopyFiles@2
          displayName: 'Move desired artifacts to "temp" folder'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)
            contents: |
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/Actuator_Control/model_standards_results/**
                    04_Results/Flight_Control/model_standards_results/**
                    04_Results/InnerLoop_Control/model_standards_results/**
                    04_Results/OuterLoop_Control/model_standards_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)/temp/
          condition: succeededOrFailed()   
        
        - task: PublishPipelineArtifact@1
          displayName: 'Upload Artifacts' 
          inputs:
            targetPath: $(System.DefaultWorkingDirectory)/temp/
            artifact: 'Check_Modeling_Standards_padv_artifacts'
            publishLocation: 'pipeline' 
          condition: succeededOrFailed()    

        - task: PublishTestResults@2
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                padv_builtin_task_RunModelStandards_Actuator_Control_JUnit.xml
                padv_builtin_task_RunModelStandards_AHRS_Voter_JUnit.xml
                padv_builtin_task_RunModelStandards_Flight_Control_JUnit.xml
                padv_builtin_task_RunModelStandards_InnerLoop_Control_JUnit.xml
                padv_builtin_task_RunModelStandards_OuterLoop_Control_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'
          condition: succeededOrFailed()  
  
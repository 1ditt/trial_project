trigger:
  branches:
    include:
      - main

stages:
- stage: Sample_Stage
  displayName: Sample Stage
  jobs:
  - job: Sample_Job
    pool: Default  
    steps:
     - script: |
            echo "SAMPLE STAGE FOR PARALLEL PIPELINE"
 
  


- stage: Generate_Simulink_Web_View_AHRS_Voter
  dependsOn: Sample_Stage
  
  jobs:
  - job: Generate_Simulink_Web_View_AHRS_Voter
    displayName: 'Generate_Simulink_Web_View_AHRS_Voter'
    pool: Default
    
    steps:
    - checkout: self
      displayName: 'Checkout Repository'
      
    - script: |
          # Create a cache_folder in $(System.DefaultWorkingDirectory)
          mkdir $(System.DefaultWorkingDirectory)/cache_folder
      displayName: 'Create Cache Folder'   
      
    - task: Cache@2
      displayName: Restore Cache
      inputs:
        key: 'AHRS_C'  
        path: |
                $(System.DefaultWorkingDirectory)/cache_folder    
        cacheHitVar: CACHE_RESTORED      
        
    - task: Cache@2
      displayName: Restore Cache from last job
      inputs:
        key: 'caching_AHRS|$(Build.BuildId)'
        restoreKeys: caching_AHRS
        path: |
                $(System.DefaultWorkingDirectory)/cache_folder   
      condition: eq(variables.CACHE_RESTORED, 'true')   
      
    - task: CopyFiles@2
      displayName: 'Move cache to Respective Folders'
      inputs:
        sourceFolder: $(System.DefaultWorkingDirectory)/cache_folder
        contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
        targetFolder: $(System.DefaultWorkingDirectory)   
        
    - task: CmdLine@2
      displayName: 'Launch MATLAB'
      inputs:
        script: |
         mw -using bslcicd matlab -nodesktop -logfile output.log -batch "openProject(pwd);runprocess(Tasks = {'padv.builtin.task.GenerateSimulinkWebView|sl_model_file|ProcessAdvisorExample|02_Models/AHRS_Voter/specification/AHRS_Voter.slx'}, Force = false, ExitInBatchMode = true, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true);" 
    
    
    - task: CopyFiles@2
      displayName: 'Move desired artifacts to "cache_folder" folder'
      inputs:
        sourceFolder: $(System.DefaultWorkingDirectory)
        contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
        targetFolder: $(System.DefaultWorkingDirectory)/cache_folder/

    - task: PublishTestResults@2
      inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |          
                  padv_builtin_task_GenerateSimulinkWebView_AHRS_Voter_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'
   
    - task: PublishPipelineArtifact@1
      displayName: 'Upload Artifacts' 
      inputs:
        targetPath: $(System.DefaultWorkingDirectory)/cache_folder/
        artifact: ' AHRS_Voter_padv_artifacts_1'
        publishLocation: 'pipeline' 



- stage: Check_Modeling_Standards_AHRS_Voter
  dependsOn: Generate_Simulink_Web_View_AHRS_Voter    
  
  jobs:
  - job: Check_Modeling_Standards_AHRS_Voter
    displayName: 'Check_Modeling_Standards_AHRS_Voter'
    pool: Default
    
    steps:
    - checkout: self 
      displayName: 'Checkout Repository'
      
    - task: DownloadPipelineArtifact@2
      displayName: 'Download Artifacts'
      inputs:
       artifactName: 'AHRS_Voter_padv_artifacts_1'
       downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
       
    - task: CopyFiles@2
      displayName: 'Move Artifacts to Respective Folders'
      inputs:
        sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
        contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
        targetFolder: $(System.DefaultWorkingDirectory)

    - task: CmdLine@2
      displayName: 'Launch MATLAB'
      inputs:
        script: |
           mw -using bslcicd matlab  -nodesktop -logfile output.log -batch "openProject(pwd);runprocess(Tasks = {'padv.builtin.task.RunModelStandards|sl_model_file|ProcessAdvisorExample|02_Models/AHRS_Voter/specification/AHRS_Voter.slx'}, Force = false, ExitInBatchMode = true, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true);" 
   
    - task: CopyFiles@2
      displayName: 'Move desired artifacts to "temp" folder'
      inputs:
        sourceFolder: $(System.DefaultWorkingDirectory)
        contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
        targetFolder: $(System.DefaultWorkingDirectory)/temp/
        
    - task: PublishPipelineArtifact@1
      displayName: 'Upload Artifacts' 
      inputs:
        targetPath: $(System.DefaultWorkingDirectory)/temp/
        artifact: 'AHRS_Voter_padv_artifacts_2'
        publishLocation: 'pipeline' 
    - task: PublishTestResults@2
      inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                   padv_builtin_task_RunModelStandards_AHRS_Voter_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'


- stage: Detect_Design_Errors_AHRS_Voter
  dependsOn: Check_Modeling_Standards_AHRS_Voter 
  
  jobs:
  - job: Detect_Design_Errors_AHRS_Voter 
    displayName: 'Detect_Design_Errors_AHRS_Voter'
    pool: Default
    
    steps:
    - checkout: self 
      displayName: 'Checkout Repository'  
      
    - task: DownloadPipelineArtifact@2
      displayName: 'Download Artifacts'
      inputs:
       artifactName: 'AHRS_Voter_padv_artifacts_2'
       downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts1
       
    - task: CopyFiles@2
      displayName: 'Move Artifacts to Respective Folders'
      inputs:
       sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts1
       contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
       targetFolder: $(System.DefaultWorkingDirectory)

    - task: CmdLine@2
      displayName: 'Launch MATLAB'
      inputs:
       script: |
        mw -using bslcicd matlab  -nodesktop -logfile output.log -batch "openProject(pwd);runprocess(Tasks = {'padv.builtin.task.DetectDesignErrors|sl_model_file|ProcessAdvisorExample|02_Models/AHRS_Voter/specification/AHRS_Voter.slx'}, Force = false, ExitInBatchMode = true, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true);" 

    - task: CopyFiles@2
      displayName: 'move desired artifacts to "temp" folder'
      inputs:
        sourceFolder: $(System.DefaultWorkingDirectory)
        contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
        targetFolder: $(System.DefaultWorkingDirectory)/temp

    - task: PublishPipelineArtifact@1
      displayName: 'Upload Artifacts' 
      inputs:
       targetPath: $(System.DefaultWorkingDirectory)/temp/
       artifact: 'AHRS_Voter_padv_artifacts_3'
       publishLocation: 'pipeline'   

    - task: PublishTestResults@2
      inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                   padv_builtin_task_DetectDesignErrors_AHRS_Voter_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'   
   
 
- stage: Generate_SDD_Report_AHRS_Voter
  dependsOn: Detect_Design_Errors_AHRS_Voter 
  
  jobs:
  - job: Generate_SDD_Report_AHRS_Voter
    displayName: 'Generate_SDD_Report_AHRS_Voter'
    pool: Default
    
    steps:
        - checkout: self 
          displayName: 'Checkout Repository'
          
        - task: DownloadPipelineArtifact@2
          displayName: 'Download Artifacts'
          inputs:
           artifactName: 'AHRS_Voter_padv_artifacts_3'
           downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
           
        - task: CopyFiles@2
          displayName: 'Move Artifacts to Respective Folders'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)
            
        - task: CmdLine@2
          displayName: 'Launch MATLAB'
          inputs:
            script: |
             mw -using bslcicd matlab -nodesktop -logfile output.log -batch "openProject(pwd);[~,exitCode] = runprocess(Tasks = {'padv.builtin.task.GenerateSDDReport|sl_model_file|ProcessAdvisorExample|02_Models/AHRS_Voter/specification/AHRS_Voter.slx'}, Force = false, ExitInBatchMode = false, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true);exit(exitCode);" 

        - task: CopyFiles@2
          displayName: 'Move desired artifacts to "temp" folder'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)/temp/
        
        - task: PublishPipelineArtifact@1
          displayName: 'Upload Artifacts' 
          inputs:
            targetPath: $(System.DefaultWorkingDirectory)/temp/
            artifact: 'AHRS_Voter_padv_artifacts_4'
            publishLocation: 'pipeline' 

        - task: PublishTestResults@2
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                padv_builtin_task_GenerateSDDReport_AHRS_Voter_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'
            

- stage: Run_Tests_AHRS_Voter
  dependsOn:  Generate_SDD_Report_AHRS_Voter
  
  jobs:
  - job:  Run_Tests_AHRS_Voter
    displayName: '  Run_Tests_AHRS_Voter'
    pool: Default
    
    steps:
        - checkout: self 
          displayName: 'Checkout Repository'
          
        - task: DownloadPipelineArtifact@2
          displayName: 'Download Artifacts'
          inputs:
           artifactName: 'AHRS_Voter_padv_artifacts_4'
           downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
           
        - task: CopyFiles@2
          displayName: 'Move Artifacts to Respective Folders'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)
            
        - task: CmdLine@2
          displayName: 'Launch MATLAB'
          inputs:
            script: |
             mw -using bslcicd matlab -nodesktop -logfile output.log  -batch "openProject(pwd);[~,exitCode] = runprocess(Tasks = {'padv.builtin.task.RunTestsPerTestCase|sl_test_case|ProcessAdvisorExample|02_Models/AHRS_Voter/test_cases/AHRS_Voter_REQ_Based_Test.mldatx|ced877ff-cfb8-4fa8-9bbf-aaa29b1d926b', 'padv.builtin.task.RunTestsPerTestCase|sl_test_case|ProcessAdvisorExample|02_Models/AHRS_Voter/test_cases/AHRS_Voter_REQ_Based_Test.mldatx|d3a72cc8-687b-44ae-a909-7eff803b455b', 'padv.builtin.task.RunTestsPerTestCase|sl_test_case|ProcessAdvisorExample|02_Models/AHRS_Voter/test_cases/AHRS_Voter_REQ_Based_Test.mldatx|74194125-b632-41a1-b96d-b3364441277f'}, Force = false, ExitInBatchMode = false, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true);exit(exitCode);" 

        
        - task: CopyFiles@2
          displayName: 'Move desired artifacts to "temp" folder'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)/temp/
        
        - task: PublishPipelineArtifact@1
          displayName: 'Upload Artifacts' 
          inputs:
            targetPath: $(System.DefaultWorkingDirectory)/temp/
            artifact: 'AHRS_Voter_padv_artifacts_5'
            publishLocation: 'pipeline' 

        - task: PublishTestResults@2
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                padv_builtin_task_RunTestsPerTestCase_HLR_11_JUnit.xml
                padv_builtin_task_RunTestsPerTestCase_HLR_12_JUnit.xml
                padv_builtin_task_RunTestsPerTestCase_HLR_13_JUnit.xml   
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'
            

- stage: Generate_Code_AHRS_Voter
  dependsOn: Run_Tests_AHRS_Voter
  
  jobs:
  - job: Generate_Code_AHRS_Voter
    displayName: 'Generate_Code_AHRS_Voter'
    pool: Default
    
    steps:
        - checkout: self 
          displayName: 'Checkout Repository'
          
        - task: DownloadPipelineArtifact@2
          displayName: 'Download Artifacts'
          inputs:
           artifactName: 'AHRS_Voter_padv_artifacts_5'
           downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
           
        - task: CopyFiles@2
          displayName: 'Move Artifacts to Respective Folders'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)
            
        - task: CmdLine@2
          displayName: 'Launch MATLAB'
          inputs:
            script: |
             mw -using bslcicd matlab -nodesktop -logfile output.log  -batch "openProject(pwd);[~,exitCode] = runprocess(Tasks = {'padv.builtin.task.GenerateCode|sl_model_file|ProcessAdvisorExample|02_Models/AHRS_Voter/specification/AHRS_Voter.slx'}, Force = false, ExitInBatchMode = false, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true);exit(exitCode);" 
        
        - task: CopyFiles@2
          displayName: 'Move desired artifacts to "temp" folder'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)/temp/
        
        - task: PublishPipelineArtifact@1
          displayName: 'Upload Artifacts' 
          inputs:
            targetPath: $(System.DefaultWorkingDirectory)/temp/
            artifact: 'AHRS_Voter_padv_artifacts_6'
            publishLocation: 'pipeline' 

        - task: PublishTestResults@2
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                padv_builtin_task_GenerateCode_AHRS_Voter_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'
            
          
 
- stage:  Check_Coding_Standards_AHRS_Voter
  dependsOn: Generate_Code_AHRS_Voter
  
  jobs:
  - job:  Check_Coding_Standards_AHRS_Voter
    displayName: 'Check_Coding_Standards_AHRS_Voter'
    pool: Default
    
    steps:
        - checkout: self 
          displayName: 'Checkout Repository'
          
        - task: DownloadPipelineArtifact@2
          displayName: 'Download Artifacts'
          inputs:
           artifactName: 'AHRS_Voter_padv_artifacts_6'
           downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
           
        - task: CopyFiles@2
          displayName: 'Move Artifacts to Respective Folders'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)
            
        - task: CmdLine@2
          displayName: 'Launch MATLAB'
          inputs:
            script: |
             mw -using bslcicd matlab -nodesktop -logfile output.log -batch "openProject(pwd);[~,exitCode] = runprocess(Tasks = {'padv.builtin.task.AnalyzeModelCode|sl_model_file|ProcessAdvisorExample|02_Models/AHRS_Voter/specification/AHRS_Voter.slx'}, Force = false, ExitInBatchMode = false, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true);exit(exitCode);" 
        
        - task: CopyFiles@2
          displayName: 'Move desired artifacts to "temp" folder'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)/temp/
        
        - task: PublishPipelineArtifact@1
          displayName: 'Upload Artifacts' 
          inputs:
            targetPath: $(System.DefaultWorkingDirectory)/temp/
            artifact: 'AHRS_Voter_padv_artifacts_7'
            publishLocation: 'pipeline' 

        - task: PublishTestResults@2
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                padv_builtin_task_AnalyzeModelCode_AHRS_Voter_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'
            
          

- stage: Prove_Code_Quality_AHRS_Voter
  dependsOn: Check_Coding_Standards_AHRS_Voter
  
  jobs:
  - job:   Prove_Code_Quality_AHRS_Voter
    displayName: 'Prove_Code_Quality_AHRS_Voter'
    pool: Default
    
    steps:
        - checkout: self 
          displayName: 'Checkout Repository'
          
        - task: DownloadPipelineArtifact@2
          displayName: 'Download Artifacts'
          inputs:
           artifactName: 'AHRS_Voter_padv_artifacts_7'
           downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
           
        - task: CopyFiles@2
          displayName: 'Move Artifacts to Respective Folders'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)
            
        - task: CmdLine@2
          displayName: 'Launch MATLAB'
          inputs:
            script: |
             mw -using bslcicd matlab -nodesktop -logfile output.log -batch "openProject(pwd);[~,exitCode] = runprocess(Tasks = {'ProveCodeQuality|sl_model_file|ProcessAdvisorExample|02_Models/AHRS_Voter/specification/AHRS_Voter.slx'}, Force = false, ExitInBatchMode = false, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true);exit(exitCode);" 
        - task: CopyFiles@2
          displayName: 'Move desired artifacts to "temp" folder'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)/temp/
        
        - task: PublishPipelineArtifact@1
          displayName: 'Upload Artifacts' 
          inputs:
            targetPath: $(System.DefaultWorkingDirectory)/temp/
            artifact: 'AHRS_Voter_padv_artifacts_8'
            publishLocation: 'pipeline' 

        - task: PublishTestResults@2
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                ProveCodeQuality_AHRS_Voter_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'
          
        
- stage: Inspect_Code_AHRS_Voter
  dependsOn: Prove_Code_Quality_AHRS_Voter
  
  jobs:
  - job:  Inspect_Code_AHRS_Voter
    displayName: ' Inspect_Code_AHRS_Voter'
    pool: Default
    
    steps:
        - checkout: self 
          displayName: 'Checkout Repository'
          
        - task: DownloadPipelineArtifact@2
          displayName: 'Download Artifacts'
          inputs:
           artifactName: 'AHRS_Voter_padv_artifacts_8'
           downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
           
        - task: CopyFiles@2
          displayName: 'Move Artifacts to Respective Folders'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)
            
        - task: CmdLine@2
          displayName: 'Launch MATLAB'
          inputs:
            script: |
             mw -using bslcicd matlab -nodesktop -logfile output.log -batch "openProject(pwd);[~,exitCode] = runprocess(Tasks = {'padv.builtin.task.RunCodeInspection|sl_model_file|ProcessAdvisorExample|02_Models/AHRS_Voter/specification/AHRS_Voter.slx'}, Force = false, ExitInBatchMode = false, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true) ;exit(exitCode);" 

        - task: CopyFiles@2
          displayName: 'Move desired artifacts to "temp" folder'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)/temp/
        
        - task: PublishPipelineArtifact@1
          displayName: 'Upload Artifacts' 
          inputs:
            targetPath: $(System.DefaultWorkingDirectory)/temp/
            artifact: 'AHRS_Voter_padv_artifacts_9'
            publishLocation: 'pipeline' 

        - task: PublishTestResults@2
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                padv_builtin_task_RunCodeInspection_AHRS_Voter_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'


- stage: Merge_Test_Results_AHRS_Voter
  dependsOn: Inspect_Code_AHRS_Voter
  
  jobs:
  - job: Merge_Test_Results_AHRS_Voter
    displayName: 'Merge_Test_Results_AHRS_Voter'
    pool: Default
    
    steps:
        - checkout: self 
          displayName: 'Checkout Repository'
          
        - task: DownloadPipelineArtifact@2
          displayName: 'Download Artifacts'
          inputs:
           artifactName: 'AHRS_Voter_padv_artifacts_9'
           downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
           
        - task: CopyFiles@2
          displayName: 'Move Artifacts to Respective Folders'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)
            
        - task: CmdLine@2
          displayName: 'Launch MATLAB'
          inputs:
            script: |
             mw -using bslcicd matlab -nodesktop -logfile output.log  -batch "openProject(pwd);[~,exitCode] = runprocess(Tasks = {'padv.builtin.task.MergeTestResults|sl_model_file|ProcessAdvisorExample|02_Models/AHRS_Voter/specification/AHRS_Voter.slx'}, Force = false, ExitInBatchMode = false, RerunFailedTasks = false, RerunErroredTasks = false, GenerateJUnitForProcess = true); exit(exitCode);" 
        
        - task: CopyFiles@2
          displayName: 'Move desired artifacts to "temp" folder'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)/temp/
        
        - task: PublishPipelineArtifact@1
          displayName: 'Upload Artifacts' 
          inputs:
            targetPath: $(System.DefaultWorkingDirectory)/temp/
            artifact: 'AHRS_Voter_padv_artifacts_10'
            publishLocation: 'pipeline' 

        - task: PublishTestResults@2
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: |
                padv_builtin_task_MergeTestResults_AHRS_Voter_JUnit.xml
            searchFolder: '$(System.DefaultWorkingDirectory)/04_Results/junit'
                                    

- stage: Generate_PADV_Report_AHRS_Voter
  dependsOn: Merge_Test_Results_AHRS_Voter
  
  jobs:
  - job: Generate_PADV_Report_AHRS_Voter
    displayName: 'Generate_PADV_Report_AHRS_Voter'
    pool: Default
    
    steps:
        - checkout: self 
          displayName: 'Checkout Repository'
          
        - task: DownloadPipelineArtifact@2
          displayName: 'Download Artifacts'
          inputs:
           artifactName: 'AHRS_Voter_padv_artifacts_10'
           downloadPath: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
           
        - task: CopyFiles@2
          displayName: 'Move Artifacts to Respective Folders'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)/DownloadedArtifacts
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)
            
        - task: CmdLine@2
          displayName: 'Launch MATLAB'
          inputs:
            script: |
              mw -using bslcicd matlab -nodesktop -logfile output.log -batch "openProject(pwd); 
              rptObj=padv.ProcessAdvisorReportGenerator(Format='pdf', OutputPath=fullfile(currentProject().RootFolder,'ProcessAdvisorReport'));
              rptObj.generateReport();" 
        
        - task: CopyFiles@2
          displayName: 'Move desired artifacts to "temp" folder'
          inputs:
            sourceFolder: $(System.DefaultWorkingDirectory)
            contents: |
                    03_Code/**
                    04_Results/AHRS_Voter/code_inspection/**
                    04_Results/AHRS_Voter/code_quality/**
                    04_Results/AHRS_Voter/coding_standards/**
                    04_Results/AHRS_Voter/design_error_detections/**
                    04_Results/AHRS_Voter/model_comparison/**
                    04_Results/AHRS_Voter/model_standards_results/**
                    04_Results/AHRS_Voter/system_design_description/**
                    04_Results/AHRS_Voter/webview/**
                    04_Results/test_results/**
                    derived/artifacts.dmr
            targetFolder: $(System.DefaultWorkingDirectory)/temp/
        
        - task: PublishPipelineArtifact@1
          displayName: 'Upload Artifacts' 
          inputs:
            targetPath: $(System.DefaultWorkingDirectory)/temp/
            artifact: 'AHRS_Voter_padv_artifacts_11'
            publishLocation: 'pipeline'    

- stage: Collect_Artifacts_AHRS_Voter
  dependsOn: Generate_PADV_Report_AHRS_Voter
  
  jobs:
  - job: Collect_Artifacts_AHRS_Voter
    displayName: 'Collect_Artifacts_AHRS_Voter'
    pool: Default
    
    steps:
        - task: Cache@2
          displayName: Restore Cache
          inputs:
            key: 'caching_AHRS|$(Build.BuildId)'  
            path: |
                    $(System.DefaultWorkingDirectory)/cache_folder 
                    
        - task: DownloadPipelineArtifact@2
          displayName: 'Download Artifacts'
          inputs:
           artifactName: 'AHRS_Voter_padv_artifacts_11'
           downloadPath: $(System.DefaultWorkingDirectory)/cache_folder
  
        